<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ink & Affection | 18th</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;500&family=Dancing+Script:wght@600&family=Homemade+Apple&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* RADIAL VIGNETTE BACKGROUND */
        body { 
            margin: 0; 
            height: 100vh;
            /* Dark grey center fading to black edges */
            background: radial-gradient(circle at center, #2a2a2a 0%, #000000 90%);
            color: white; 
            font-family: 'Inter', sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            overflow: hidden; 
        }

        /* --- STAGE 1: THE ENVELOPE --- */
        #envelope-stage {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; width: 100%; transition: 0.8s ease-in-out; z-index: 10;
        }
        
        .envelope {
            width: 300px; height: 200px; background: #1a1a1a; 
            position: relative; border-radius: 5px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.3s;
            box-shadow: 0 15px 35px rgba(0,0,0,0.8);
            border: 1px solid #333;
        }
        .envelope:hover { transform: scale(1.05) translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,1); }
        
        .envelope::before {
            content: ''; position: absolute; top: 0; left: 0; 
            width: 0; height: 0; 
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 100px solid #252525;
            transform-origin: top; transition: 0.5s; z-index: 2;
        }
        
        .wax-seal {
            width: 60px; height: 60px; background: #8b0000;
            border-radius: 50%; z-index: 10;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 5px 10px rgba(0,0,0,0.5);
            display: flex; justify-content: center; align-items: center;
            font-family: 'Cinzel', serif; font-size: 28px; color: rgba(0,0,0,0.4);
            border: 2px dashed rgba(255,255,255,0.1);
        }

        .tap-hint { margin-top: 30px; opacity: 0.5; letter-spacing: 3px; text-transform: uppercase; font-size: 0.8rem; font-family: 'Cinzel', serif; animation: pulse 2s infinite; }

        /* --- STAGE 2: THE WRITING DESK --- */
        #writing-desk {
            display: none; width: 100%; max-width: 600px; height: 100vh;
            flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; transform: translateY(50px); transition: 1s;
            position: relative; z-index: 5;
        }

        h2 { font-family: 'Cinzel', serif; color: #D4AF37; margin-bottom: 5px; font-size: 1.8rem; text-shadow: 0 0 10px rgba(212, 175, 55, 0.3); text-align: center; }
        .subtitle { font-family: 'Inter'; font-size: 0.8rem; color: var(--gold); margin-bottom: 25px; letter-spacing: 1px; text-transform: uppercase; opacity: 0.7; color: #D4AF37; text-align: center; }

        .toolbar { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
        
        .tool-btn {
            background: rgba(0,0,0,0.6); border: 1px solid #444; color: #aaa;
            padding: 6px 12px; border-radius: 4px; cursor: pointer; transition: 0.3s;
            font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px;
        }
        .tool-btn:hover { border-color: #D4AF37; color: #D4AF37; }

        /* --- THE MAGIC PAPER (UPDATED JAGGED EDGES) --- */
        .letter-paper {
            width: 85%; height: 50vh; padding: 40px;
            color: #222;
            border: none; outline: none; resize: none;
            transition: all 0.5s ease;
            
            /* JAGGED EDGE MAGIC (All 4 Sides) */
            clip-path: polygon(
                /* TOP */
                0% 1%, 2% 0%, 5% 2%, 8% 0%, 11% 1%, 15% 0%, 18% 2%, 22% 0%, 25% 1%, 29% 0%, 33% 2%, 37% 0%, 41% 1%, 45% 0%, 50% 2%, 55% 0%, 59% 1%, 63% 0%, 67% 2%, 72% 0%, 76% 1%, 80% 0%, 85% 2%, 90% 0%, 95% 1%, 98% 0%, 100% 1%,
                /* RIGHT */
                99% 5%, 100% 10%, 98% 15%, 100% 20%, 99% 25%, 100% 30%, 98% 35%, 100% 40%, 99% 45%, 100% 50%, 98% 55%, 100% 60%, 99% 65%, 100% 70%, 98% 75%, 100% 80%, 99% 85%, 100% 90%, 98% 95%, 100% 99%,
                /* BOTTOM */
                98% 100%, 95% 98%, 90% 100%, 85% 99%, 80% 100%, 75% 98%, 70% 100%, 65% 99%, 60% 100%, 55% 98%, 50% 100%, 45% 99%, 40% 100%, 35% 98%, 30% 100%, 25% 99%, 20% 100%, 15% 98%, 10% 100%, 5% 99%, 2% 100%, 0% 99%,
                /* LEFT */
                1% 95%, 0% 90%, 2% 85%, 0% 80%, 1% 75%, 0% 70%, 2% 65%, 0% 60%, 1% 55%, 0% 50%, 2% 45%, 0% 40%, 1% 35%, 0% 30%, 2% 25%, 0% 20%, 1% 15%, 0% 10%, 2% 5%
            );
            
            /* Use Filter instead of Box-Shadow for jagged edges */
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.8));

            /* Base Image */
            background-image: url('paper.jpg'); 
            background-repeat: no-repeat;
        }
        
        /* 1. CLASSIC */
        .style-classic { 
            background-size: cover; 
            background-position: center;
            background-color: transparent; 
            font-family: 'Dancing Script', cursive; 
            font-size: 1.5rem;
            line-height: 1.6;
            color: #222;
        } 
        
        /* 2. MIDNIGHT (Zoomed & Dark) */
        .style-midnight { 
            background-size: 200%; 
            background-position: top left; 
            background-color: #1a1a1a; 
            background-blend-mode: hard-light; 
            color: #D4AF37; 
            font-family: 'Inter', sans-serif; 
            font-weight: 300;
            font-size: 1rem;
            line-height: 1.8;
        }
        
        /* 3. PARCHMENT (Messy) */
        .style-parchment { 
            background-size: 150%; 
            background-position: bottom right; 
            background-color: #d4c5a3; 
            background-blend-mode: multiply; 
            color: #3b2a1a; 
            font-family: 'Homemade Apple', cursive; 
            font-size: 1.2rem;
            line-height: 2;
        }
        
        /* 4. ROSE (Elegant) */
        .style-rose { 
            background-size: 120%; 
            background-position: center; 
            background-color: #ffe4e1; 
            background-blend-mode: multiply; 
            color: #6d0f0f; 
            font-family: 'Playfair Display', serif; 
            font-weight: 600;
            font-style: italic;
            font-size: 1.3rem;
            line-height: 1.6;
        }

        .inputs-row { display: flex; gap: 10px; width: 90%; margin-top: 15px; }
        .simple-input {
            flex: 1; padding: 12px; background: rgba(0,0,0,0.6); border: 1px solid #444; 
            color: white; border-radius: 4px; outline: none; font-family: 'Inter', sans-serif;
        }
        .simple-input:focus { border-color: #D4AF37; }

        .seal-btn {
            margin-top: 25px; background: #8b0000; color: white;
            border: 1px solid #500; padding: 12px 40px; border-radius: 50px;
            font-family: 'Cinzel', serif; font-size: 1rem; cursor: pointer;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.4);
            transition: 0.3s;
        }
        .seal-btn:hover { transform: scale(1.05); background: #a50000; box-shadow: 0 0 30px rgba(165, 0, 0, 0.6); }

        .privacy-note { margin-top: 15px; font-size: 0.7rem; opacity: 0.4; display: flex; align-items: center; gap: 5px; }

        /* --- STAGE 3: HEDWIG --- */
        #success-msg {
            display: none; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; text-align: center; position: absolute; top:0; width: 100%; z-index: 20;
        }
        
        #hedwig-img {
            position: absolute;
            bottom: -200px; left: 50%;
            width: 250px; 
            transform: translateX(-50%);
            display: none;
            z-index: 100;
            /* mix-blend-mode: screen; */ /* UNCOMMENT IF BACKGROUND IS BLACK */
        }

        @keyframes flyAway {
            0% { bottom: -200px; left: 50%; transform: translateX(-50%) scale(0.8); }
            30% { bottom: 30%; left: 50%; transform: translateX(-50%) scale(1.2); }
            100% { bottom: 120%; left: 120%; transform: translateX(-50%) scale(0.5); }
        }

        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 0.8; } 100% { opacity: 0.3; } }

    </style>
</head>
<body>

    <div id="envelope-stage" onclick="openDesk()">
        <div class="envelope">
            <div class="wax-seal">H</div>
        </div>
        <div class="tap-hint">Tap to break the seal</div>
    </div>

    <div id="writing-desk">
        <h2>Ink & Affection: For Her 18th</h2>
        <p class="subtitle">Leave a letter she will cherish forever</p>
        
        <div class="toolbar">
            <div class="tool-btn" onclick="setPaper('style-classic')">Original</div>
            <div class="tool-btn" onclick="setPaper('style-midnight')">Midnight</div>
            <div class="tool-btn" onclick="setPaper('style-parchment')">Aged</div>
            <div class="tool-btn" onclick="setPaper('style-rose')">Rose</div>
            
            <select id="moodSelect" class="tool-btn" style="background:rgba(0,0,0,0.6); color:#aaa; border:1px solid #444;">
                <option value="heartfelt">‚ù§Ô∏è Heartfelt</option>
                <option value="nostalgic">üï∞Ô∏è Nostalgic</option>
                <option value="funny">üòÇ Funny</option>
                <option value="proud">‚ú® Proud</option>
            </select>
        </div>

        <textarea id="letterBody" class="letter-paper style-classic" placeholder="Dearest..."></textarea>

        <div class="inputs-row">
            <input type="text" id="senderName" class="simple-input" placeholder="Your Name">
            <input type="text" id="oneWord" class="simple-input" placeholder="One word describing her">
        </div>

        <div class="privacy-note">
            <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16"><path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/></svg>
            Encrypted & Private. Only she will open this.
        </div>

        <button class="seal-btn" id="sendBtn" onclick="sendLetter()">
            Seal & Send
        </button>
    </div>

    <div id="success-msg">
        <h1 style="font-family: 'Cinzel'; color: #D4AF37; margin-bottom: 10px;">Letter Sealed.</h1>
        <p style="font-family: 'Inter'; opacity: 0.7; max-width: 400px; line-height: 1.6;">
            Hedwig has taken flight.<br>
            Your letter is on its way to her.
        </p>
    </div>

    <img src="owl.gif" id="hedwig-img" alt="Hedwig">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBPHhWTmAqPkZ8mRSGGxcBp3lgWUBzstMk",
            authDomain: "website-665c0.firebaseapp.com",
            projectId: "website-665c0",
            storageBucket: "website-665c0.firebasestorage.app",
            messagingSenderId: "831316473256",
            appId: "1:831316473256:web:1671afdcfc4597383d199d",
            measurementId: "G-DFC7C5VNMZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const lettersCol = collection(db, "letters");

        window.openDesk = () => {
            const env = document.getElementById('envelope-stage');
            const desk = document.getElementById('writing-desk');
            env.style.transform = 'translateY(-100vh)';
            env.style.opacity = '0';
            setTimeout(() => {
                env.style.display = 'none';
                desk.style.display = 'flex';
                setTimeout(() => {
                    desk.style.opacity = '1';
                    desk.style.transform = 'translateY(0)';
                }, 50);
            }, 600);
        };

        window.setPaper = (styleClass) => {
            const paper = document.getElementById('letterBody');
            // Reset base class then add new style
            paper.className = `letter-paper ${styleClass}`;
        };

        window.sendLetter = async () => {
            const btn = document.getElementById('sendBtn');
            const sender = document.getElementById('senderName').value.trim();
            const message = document.getElementById('letterBody').value.trim();
            const oneWord = document.getElementById('oneWord').value.trim();
            const mood = document.getElementById('moodSelect').value;
            const paper = document.getElementById('letterBody');
            
            let style = 'classic';
            if(paper.classList.contains('style-midnight')) style = 'midnight';
            if(paper.classList.contains('style-parchment')) style = 'parchment';
            if(paper.classList.contains('style-rose')) style = 'rose';

            if(!sender || !message) {
                alert("Please sign your name and write a message.");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Sealing...";

            try {
                await addDoc(lettersCol, {
                    sender, message, oneWord, mood, style, timestamp: serverTimestamp()
                });

                const desk = document.getElementById('writing-desk');
                const owl = document.getElementById('hedwig-img');
                const success = document.getElementById('success-msg');

                desk.style.opacity = '0';
                desk.style.transform = 'translateY(50px)';
                
                setTimeout(() => {
                    desk.style.display = 'none';
                    owl.style.display = 'block';
                    owl.style.animation = 'flyAway 4s ease-in-out forwards';
                    setTimeout(() => {
                        success.style.display = 'flex';
                        confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 }, colors: ['#D4AF37', '#ffffff'] });
                    }, 1500);
                }, 800);
            } catch (e) {
                alert("Error sending. Check internet.");
                btn.disabled = false;
                btn.innerText = "Seal & Send";
            }
        };
    </script>
</body>
</html>
